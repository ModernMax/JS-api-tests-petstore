"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.transformRequestBodies = exports.transformResponsesObj = void 0;
const utils_1 = require("../utils");
const headers_1 = require("./headers");
const schema_1 = require("./schema");
const operation_1 = require("./operation");
const resType = (res) => (res === 204 || (res >= 300 && res < 400) ? "never" : "unknown");
function transformResponsesObj(responsesObj, options) {
    const { immutableTypes } = options;
    const readonly = utils_1.tsReadonly(immutableTypes);
    let output = "";
    Object.entries(responsesObj).forEach(([httpStatusCode, response]) => {
        if (response.description)
            output += utils_1.comment(response.description);
        const statusCode = Number(httpStatusCode) || `"${httpStatusCode}"`;
        if (response.$ref) {
            output += `  ${readonly}${statusCode}: ${utils_1.transformRef(response.$ref)};\n`;
            return;
        }
        if ((!response.content && !response.schema) || (response.content && !Object.keys(response.content).length)) {
            output += `  ${readonly}${statusCode}: ${resType(statusCode)};\n`;
            return;
        }
        output += `  ${readonly}${statusCode}: {\n`;
        if (response.headers && Object.keys(response.headers).length) {
            if (response.headers.$ref) {
                output += `    ${readonly}headers: ${utils_1.transformRef(response.headers.$ref)};\n`;
            }
            else {
                output += `    ${readonly}headers: {\n      ${headers_1.transformHeaderObjMap(response.headers, options)}\n    }\n`;
            }
        }
        if (response.content && Object.keys(response.content).length) {
            output += `    ${readonly}content: {\n`;
            Object.entries(response.content).forEach(([contentType, contentResponse]) => {
                const responseType = contentResponse && contentResponse.schema
                    ? schema_1.transformSchemaObj(contentResponse.schema, options)
                    : "unknown";
                output += `      ${readonly}"${contentType}": ${responseType};\n`;
            });
            output += `    }\n`;
        }
        else if (response.schema) {
            output += `  ${readonly} schema: ${schema_1.transformSchemaObj(response.schema, options)};\n`;
        }
        output += `  }\n`;
    });
    return output;
}
exports.transformResponsesObj = transformResponsesObj;
function transformRequestBodies(requestBodies, options) {
    let output = "";
    Object.entries(requestBodies).forEach(([bodyName, requestBody]) => {
        if (requestBody && requestBody.description)
            output += `  ${utils_1.comment(requestBody.description)}`;
        output += `  "${bodyName}": {`;
        output += `  ${operation_1.transformRequestBodyObj(requestBody, options)}`;
        output += `  }\n`;
    });
    return output;
}
exports.transformRequestBodies = transformRequestBodies;
//# sourceMappingURL=responses.js.map