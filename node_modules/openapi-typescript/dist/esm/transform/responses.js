import { comment, transformRef, tsReadonly } from "../utils";
import { transformHeaderObjMap } from "./headers";
import { transformSchemaObj } from "./schema";
import { transformRequestBodyObj } from "./operation";
const resType = (res) => (res === 204 || (res >= 300 && res < 400) ? "never" : "unknown");
export function transformResponsesObj(responsesObj, options) {
    const { immutableTypes } = options;
    const readonly = tsReadonly(immutableTypes);
    let output = "";
    Object.entries(responsesObj).forEach(([httpStatusCode, response]) => {
        if (response.description)
            output += comment(response.description);
        const statusCode = Number(httpStatusCode) || `"${httpStatusCode}"`;
        if (response.$ref) {
            output += `  ${readonly}${statusCode}: ${transformRef(response.$ref)};\n`;
            return;
        }
        if ((!response.content && !response.schema) || (response.content && !Object.keys(response.content).length)) {
            output += `  ${readonly}${statusCode}: ${resType(statusCode)};\n`;
            return;
        }
        output += `  ${readonly}${statusCode}: {\n`;
        if (response.headers && Object.keys(response.headers).length) {
            if (response.headers.$ref) {
                output += `    ${readonly}headers: ${transformRef(response.headers.$ref)};\n`;
            }
            else {
                output += `    ${readonly}headers: {\n      ${transformHeaderObjMap(response.headers, options)}\n    }\n`;
            }
        }
        if (response.content && Object.keys(response.content).length) {
            output += `    ${readonly}content: {\n`;
            Object.entries(response.content).forEach(([contentType, contentResponse]) => {
                const responseType = contentResponse && contentResponse.schema
                    ? transformSchemaObj(contentResponse.schema, options)
                    : "unknown";
                output += `      ${readonly}"${contentType}": ${responseType};\n`;
            });
            output += `    }\n`;
        }
        else if (response.schema) {
            output += `  ${readonly} schema: ${transformSchemaObj(response.schema, options)};\n`;
        }
        output += `  }\n`;
    });
    return output;
}
export function transformRequestBodies(requestBodies, options) {
    let output = "";
    Object.entries(requestBodies).forEach(([bodyName, requestBody]) => {
        if (requestBody && requestBody.description)
            output += `  ${comment(requestBody.description)}`;
        output += `  "${bodyName}": {`;
        output += `  ${transformRequestBodyObj(requestBody, options)}`;
        output += `  }\n`;
    });
    return output;
}
//# sourceMappingURL=responses.js.map